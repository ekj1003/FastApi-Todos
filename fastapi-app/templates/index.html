<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ìï† Ïùº Î™©Î°ù</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 30px;
        margin: 0;
        display: flex;
        justify-content: center;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Light Mode */
      body.light-mode {
        background-color: #f4f7fc;
        color: #333;
      }

      /* Dark Mode */
      body.dark-mode {
        background-color: #121212;
        color: #fff;
      }

      h1 {
        text-align: center;
        color: inherit;
      }

      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        transition: background-color 0.3s, box-shadow 0.3s;
      }

      /* Dark mode container */
      body.dark-mode .container {
        background-color: #333;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }

      label {
        font-weight: bold;
        margin-top: 10px;
      }

      input,
      select,
      button {
        width: 100%;
        padding: 10px;
        margin-top: 8px;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-sizing: border-box;
      }

      input,
      select {
        margin-bottom: 15px;
      }

      button {
        background-color: #4caf50;
        color: white;
        cursor: pointer;
        margin-top: 15px;
        margin-bottom: 20px;
      }

      button:hover {
        background-color: #45a049;
      }

      ul {
        list-style: none;
        padding: 0;
      }

      li {
        padding: 15px;
        background-color: #f9f9f9;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background-color 0.3s;
      }

      li.completed {
        text-decoration: line-through;
        color: gray;
      }

      li .priority {
        padding: 5px;
        font-weight: bold;
      }

      /* Priority color */
      .low {
        color: green;
      }

      .medium {
        color: orange;
      }

      .high {
        color: red;
      }

      small {
        font-size: 0.8em;
        color: #666;
      }

      .todo-actions button {
        margin-left: 5px;
        padding: 5px 10px;
        font-size: 0.9em;
        cursor: pointer;
      }

      .todo-actions button:hover {
        background-color: #ddd;
      }

      /* Dark mode list items */
      body.dark-mode li {
        background-color: #444;
      }
    </style>
  </head>
  <body class="light-mode">
    <div class="container">
      <h1>üìó Ìï† Ïùº Î™©Î°ù</h1>
      <button id="toggle-mode">Îã§ÌÅ¨ Î™®Îìú</button>

      <form id="todo-form">
        <label for="title">Ï†úÎ™©</label>
        <input
          type="text"
          id="title"
          placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
          required
        />

        <label for="description">ÏÑ§Î™Ö</label>
        <input
          type="text"
          id="description"
          placeholder="ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
          required
        />

        <label for="due-date">Í∏∞Ìïú</label>
        <input type="date" id="due-date" />

        <label for="priority">Ïö∞ÏÑ†ÏàúÏúÑ</label>
        <select id="priority">
          <option value="low">ÎÇÆÏùå</option>
          <option value="medium">Ï§ëÍ∞Ñ</option>
          <option value="high">ÎÜíÏùå</option>
        </select>

        <label for="tags">ÌÉúÍ∑∏</label>
        <input
          type="text"
          id="tags"
          placeholder="ÌÉúÍ∑∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)"
        />

        <button type="submit">Ìï† Ïùº Ï∂îÍ∞Ä</button>
      </form>

      <div id="todo-list-container">
        <h3>Ìï† Ïùº Î™©Î°ù</h3>
        <ul id="todo-list"></ul>
      </div>
    </div>

    <script>
      // Function to fetch the list of To-dos from the backend
      async function fetchTodos() {
        const response = await fetch("/todos");
        const todos = await response.json();
        const todoList = document.getElementById("todo-list");
        todoList.innerHTML = "";

        todos.forEach((todo) => {
          const li = document.createElement("li");
          li.className = `${todo.completed ? "completed" : ""} ${
            todo.priority
          }`;

          li.innerHTML = `
            <div>
              <span>${todo.title} - ${todo.description}</span><br />
              ${
                todo.due_date
                  ? "<small>(Í∏∞Ìïú: " + todo.due_date + ")</small>"
                  : ""
              }
              ${
                todo.tags.length
                  ? "<br><small>ÌÉúÍ∑∏: " + todo.tags.join(", ") + "</small>"
                  : ""
              }
            </div>
            <div class="todo-actions">
              <button onclick="toggleTodo(${todo.id})">${
            todo.completed ? "Ï∑®ÏÜå" : "ÏôÑÎ£å"
          }</button>
              <button onclick="editTodo(${todo.id}, '${todo.title}', '${
            todo.description
          }', '${todo.due_date}', '${todo.priority}', ${JSON.stringify(
            todo.tags
          )})">ÏàòÏ†ï</button>
              <button onclick="deleteTodo(${todo.id})">ÏÇ≠Ï†ú</button>
            </div>
          `;

          todoList.appendChild(li);
        });
      }

      // Handle form submission to add a new To-Do item
      document
        .getElementById("todo-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();
          const title = document.getElementById("title").value;
          const description = document.getElementById("description").value;
          const dueDate = document.getElementById("due-date").value;
          const priority = document.getElementById("priority").value;
          const tags = document
            .getElementById("tags")
            .value.split(",")
            .map((tag) => tag.trim())
            .filter((tag) => tag);

          await fetch("/todos", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              id: Date.now(),
              title,
              description,
              completed: false,
              due_date: dueDate,
              priority,
              tags,
            }),
          });

          document.getElementById("todo-form").reset();
          fetchTodos(); // Refresh the todo list
        });

      // Function to toggle the completion status of a To-do item
      async function toggleTodo(id) {
        await fetch(`/todos/${id}/toggle`, { method: "PUT" });
        fetchTodos();
      }

      // Function to edit a To-do item
      async function editTodo(
        id,
        currentTitle,
        currentDescription,
        currentDueDate,
        currentPriority,
        currentTags
      ) {
        const title = prompt("Ï†úÎ™© ÏàòÏ†ï:", currentTitle);
        const description = prompt("ÏÑ§Î™Ö ÏàòÏ†ï:", currentDescription);
        const dueDate = prompt("Í∏∞Ìïú ÏàòÏ†ï:", currentDueDate || "");
        const priority = prompt(
          "Ïö∞ÏÑ†ÏàúÏúÑ ÏàòÏ†ï (low, medium, high):",
          currentPriority
        );
        const tagsInput = prompt(
          "ÌÉúÍ∑∏ ÏàòÏ†ï (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ):",
          currentTags.join(", ")
        );

        if (title && description) {
          const res = await fetch(`/todos`);
          const todos = await res.json();
          const original = todos.find((todo) => todo.id === id);
          if (!original) return;

          const tags = tagsInput
            .split(",")
            .map((t) => t.trim())
            .filter(Boolean);

          await fetch(`/todos/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              id,
              title,
              description,
              due_date: dueDate,
              priority,
              tags,
              completed: original.completed,
            }),
          });
          fetchTodos();
        }
      }

      // Function to delete a To-do item
      async function deleteTodo(id) {
        await fetch(`/todos/${id}`, { method: "DELETE" });
        fetchTodos();
      }

      // Dark mode toggle functionality
      document.getElementById("toggle-mode").addEventListener("click", () => {
        const body = document.body;
        body.classList.toggle("dark-mode");
        body.classList.toggle("light-mode");
      });

      fetchTodos(); // Fetch todos on page load
    </script>
  </body>
</html>
